# Java虚拟机
Java的内存管理机制，虚拟机执行子系统，程序编译与代码优化，高效并发。

-----
TOP



-----

### Java内存管理机制

![java内存](https://github.com/Zhangchao999/Java-1/raw/master/pictures/1.jpg)
<br>图1

<br>
讲解:<br>
从线程的私有还是共享来说：<br>
线程私有:程序计数器、Java虚拟机栈、本地方法栈。<br>
线程共享:Java堆、方法区。<br>

1、程序计数器:
> 程序计数器是当前线程所执行的字节码的行号指示器。当CPU要执行指令时，需要从程序计数器中获得指令所存储单元的地址，再得到指令。 

> 由于再任意时刻，一个CPU只能执行一条线程中的指令，因此，为了使每个线程在线程执行后回到原来的线程所执行的位置，所以，每个线程都需要单独的程序计数器。

2、Java虚拟栈:
> Java栈中存放的是一个个的栈帧，每个栈帧对应的是一个被调用的方法，在栈帧中包括:局部变量表，操作数栈，运行时常量池，方法的返回地址，附加信息。

3、本地方法栈:
> 与Java方法栈类似，只是Java方法栈为执行Java方法服务，而本地方法栈执行本地方法服务。

4、Java堆：
> 用来存储对象本身或数组的。Java的程序员不需要关心内存的释放问题，由于有垃圾回收机制会自动处理。(C语言中，是通过malloc函数和free函数来申请和释放内存的).


> 堆也是Java垃圾收集器管理的主要区域，堆是被线程共享的，在JVM中只有一个堆。

5、方法区：
> 方法区在JVM中也是非常重要的区域，与堆一样，也是被线程共享的。方法区存储了每个类的信息(类名，方法信息，字段信息)，静态变量，常量，编译后的代码等。

> Class文件中除了类的字段，方法，接口外，还有常量池，用来存储编译期间生成的字面量和符号引用。

> 还有一个重要的部分就是运行的常量池，它是每个类或者接口的常量池的运行时的表现形式，在类和接口被加载到JVM后，对应的运行时的常量池就被创建出来。当然不是在Class文件中的内容才能进入运行时常量池，在运行期间新的常量也能放入运行时常量池中，如String的intern方法。

> intern方法: 返回字符串对象的规范表示。 最初的空的字符串由String类String。当调用intern方法时，如果池中包含与equals(Object)方法确定的相当于此String对象的字符串，则返回来自池中的字符串。否则，将该String对象添加到池中，并返回，String对象的引用。由此可见，对于任何两个字符串s和t ， s.intern() == t.intern()是true当且仅当s.equals(t)是true 。


![java内存](https://github.com/Zhangchao999/Java-1/raw/master/pictures/2.jpg)
<br>图2:jdk1.8之前的内存





